# Dockerfile for Tomcat
FROM tomcat:11.0.9-jdk17

# Install curl
RUN apt-get update && apt-get install -y curl gettext && rm -rf /var/lib/apt/lists/*

# Copy the custom context.xml
COPY ./context.xml /usr/local/tomcat/conf/context.xml

# Add the application to the Tomcat webapps directory
COPY ./ROOT.war /usr/local/tomcat/webapps/

# Copy the server.xml template
COPY server.xml.template /usr/local/tomcat/conf/server.xml.template

# Add an entrypoint script to generate server.xml
COPY entrypoint.sh /usr/local/bin/entrypoint.sh
RUN chmod +x /usr/local/bin/entrypoint.sh

# Set the entrypoint
ENTRYPOINT [ "/usr/local/bin/entrypoint.sh" ]

# Expose port 8080 for Tomcat
EXPOSE 8080

# Start both Tomcat
#CMD ["sh", "-c", "/usr/local/tomcat/bin/catalina.sh run"]