# ServerRoot: The top of the directory tree under which the server's configuration, error, and log files are kept.
ServerRoot "/usr/local/apache2"

# Listen on port 80
Listen 80

# Load necessary modules
LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule dir_module modules/mod_dir.so
LoadModule mime_module modules/mod_mime.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule alias_module modules/mod_alias.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule unixd_module modules/mod_unixd.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so

# ServerName: Set the server's hostname
ServerName localhost

# DocumentRoot: The directory out of which you will serve your documents
DocumentRoot "/usr/local/apache2/htdocs"
<Directory "/usr/local/apache2/htdocs">
    Options Indexes FollowSymLinks
    AllowOverride None
    Require all granted
</Directory>

# Reverse proxy
ProxyPass "/httpd" "http://tomcat-service:8080/hello"
ProxyPassReverse "/httpd" "http://tomcat-service:8080/hello"
ProxyPassReverseCookiePath / /httpd

<Proxy "balancer://tomcat_cluster">
    BalancerMember "http://tomcat-service:8080"
    ProxySet stickysession=JSESSIONID|jsessionid
</Proxy>

# Log settings
#ErrorLog "/usr/local/apache2/logs/error.log"
#CustomLog "/usr/local/apache2/logs/access.log" common
ErrorLog "/dev/stderr"
CustomLog "/dev/stdout" common
LogFormat "%h %l %u %t \"%r\" %>s %b" common

# Default MIME type
TypesConfig /usr/local/apache2/conf/mime.types
AddType application/x-compress .Z
AddType application/x-gzip .gz .tgz

# DirectoryIndex: The list of resources to look for when the client requests a directory
DirectoryIndex index.html

# Enable mod_rewrite (optional, for URL rewriting)
<IfModule mod_rewrite.c>
    RewriteEngine On
</IfModule>

# Alias for serving static files (optional)
Alias /static "/usr/local/apache2/htdocs/static"
<Directory "/usr/local/apache2/htdocs/static">
    Options Indexes FollowSymLinks
    AllowOverride None
    Require all granted
</Directory>

# Run as non-root user
User daemon
Group daemon